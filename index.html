<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dream Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f0f4f8;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    }
    .card {
      transition: all 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    .progress-bar {
      transition: width 1s ease-in-out;
    }
    .input-field:focus {
      border-color: #8b5cf6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
    }
    .tab-active {
      border-bottom: 3px solid #8b5cf6;
      color: #8b5cf6;
    }
    .goal-card {
      border-left: 4px solid;
    }
    .dark-theme {
      background-color: #1f2937;
      color: #e5e7eb;
    }
    .dark-theme input,
    .dark-theme select,
    .dark-theme textarea {
      background-color: #374151;
      color: #e5e7eb;
      border-color: #4b5563;
    }
    /* Category color borders */
    .goal-card-home { border-color: #8b5cf6; }
    .goal-card-car { border-color: #2563eb; }
    .goal-card-electronics { border-color: #f59e0b; }
    .goal-card-furniture { border-color: #10b981; }
    .goal-card-other { border-color: #ef4444; }
    .category-img {
      width: 80px;
      height: 80px;
      border-radius: 0%;
      object-fit: cover;
    }
    .contributor-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #8b5cf6;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }
    .auth-container {
      min-height: 500px;
    }
    .auth-form {
      max-width: 400px;
    }
    .auth-tabs {
      border-bottom: 1px solid #e5e7eb;
    }
    .auth-tab {
      position: relative;
      cursor: pointer;
    }
    .auth-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background-color: #8b5cf6;
    }
    .auth-tab.active {
      color: #8b5cf6;
      font-weight: 500;
    }
    /* Hide file input default appearance */
    #profilePicInput {
      display: none;
    }
    /* Expense category style */
    .expense-category-label {
      display: inline-flex;
      align-items: center;
      background-color: #eef2ff;
      color: #6366f1;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      margin-right: 0.25rem;
      margin-bottom: 0.25rem;
    }
#incomeExpensesCard .chart-legend {
  display: flex;
  flex-direction: row;
  gap: 20px;
  justify-content: center;
  align-items: center;
}
#incomeExpensesCard .legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
}
#incomeExpensesCard .legend-color {
  width: 16px;
  height: 16px;
  border-radius: 3px;
  display: inline-block;
}

.hidden {
  display: none !important;
}
  </style>
</head>
<body>
  <div class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="gradient-bg text-white p-4 shadow-lg">
      <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-2xl font-bold">Dream Tracker</h1>
        <div class="flex items-center space-x-4">
          <div id="userDisplay" class="hidden md:flex items-center space-x-2">
            <!-- Profile Picture (or Initial) -->
            <img id="profilePic" src="" alt="Avatar" class="w-8 h-8 rounded-full object-cover hidden" />
            <div id="avatarInitial" class="contributor-avatar">G</div>
            <span id="currentUserName" class="mr-2">Guest</span>
          </div>
          <!-- Theme Toggle -->
          <button id="toggleTheme" class="p-2 rounded-full hover:bg-white/20">
            <img
              src="https://cdn-icons-png.flaticon.com/512/869/869869.png"
              alt="Toggle Theme"
              class="w-6 h-6"
            />
          </button>
          <!-- Settings Button -->
          <button id="openSettingsBtn" class="p-2 rounded-full hover:bg-white/20">
            <img
              src="https://cdn-icons-png.flaticon.com/512/3524/3524639.png"
              alt="Settings"
              class="w-6 h-6"
            />
          </button>
          <!-- Logout Button -->
          <button id="logoutBtn" class="p-2 rounded-full hover:bg-white/20 hidden">
            <img
              src="https://cdn-icons-png.flaticon.com/512/159/159707.png"
              alt="Logout"
              class="w-6 h-6"
            />
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto p-4 md:p-6">
      <!-- Authentication Screen -->
      <div id="authScreen" class="block">
        <div class="max-w-3xl mx-auto bg-white rounded-xl shadow-md p-8 mb-8 text-center">
          <div class="mb-6 flex justify-center">
            <img
              src="https://cdn-icons-png.flaticon.com/512/861/861370.png"
              alt="Welcome Icon"
              class="w-16 h-16"
            />
          </div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4 text-center">
            Welcome to Dream Tracker
          </h2>
          <p class="text-gray-600 mb-8 text-center">
            Plan and track your savings and expenses with your family or roommates.
          </p>
          <div class="auth-container mx-auto">
            <!-- Auth Tabs -->
            <div class="auth-tabs flex mb-6">
              <div id="signupTab" class="auth-tab active flex-1 py-3 text-center">
                Sign Up
              </div>
              <div id="loginTab" class="auth-tab flex-1 py-3 text-center">
                Log In
              </div>
            </div>
            <!-- Signup Form -->
            <div id="signupForm" class="auth-form mx-auto">
              <form id="userSignupForm" class="space-y-4">
                <div class="text-left">
                  <label for="signupName" class="block text-sm font-medium text-gray-700 mb-1">
                    Full Name
                  </label>
                  <input
                    type="text"
                    id="signupName"
                    class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                    placeholder="Enter your full name"
                    required
                  />
                </div>
                <div class="text-left">
                  <label for="signupEmail" class="block text-sm font-medium text-gray-700 mb-1">
                    Email Address
                  </label>
                  <input
                    type="email"
                    id="signupEmail"
                    class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                    placeholder="Enter your email address"
                    required
                  />
                </div>
                <div class="text-left">
                  <label for="signupPassword" class="block text-sm font-medium text-gray-700 mb-1">
                    Password
                  </label>
                  <input
                    type="password"
                    id="signupPassword"
                    class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                    placeholder="Create a password"
                    required
                    minlength="6"
                  />
                  <p class="text-xs text-gray-500 mt-1">
                    Password must be at least 6 characters
                  </p>
                </div>
                <div class="text-left">
                  <label
                    for="signupConfirmPassword"
                    class="block text-sm font-medium text-gray-700 mb-1"
                  >
                    Confirm Password
                  </label>
                  <input
                    type="password"
                    id="signupConfirmPassword"
                    class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                    placeholder="Confirm your password"
                    required
                    minlength="6"
                  />
                </div>
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="termsAgree"
                    class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                    required
                  />
                  <label for="termsAgree" class="ml-2 block text-sm text-gray-700">
                    I agree to the
                    <a href="#" class="text-indigo-600 hover:text-indigo-800">Terms of Service</a>
                    and
                    <a href="#" class="text-indigo-600 hover:text-indigo-800">Privacy Policy</a>
                  </label>
                </div>
                <button
                  type="submit"
                  class="w-full gradient-bg text-white py-3 px-4 rounded-lg hover:opacity-90 transition-opacity font-medium"
                >
                  Create Account
                </button>
              </form>
            </div>
            <!-- Login Form -->
            <div id="loginForm" class="auth-form mx-auto hidden">
              <form id="userLoginForm" class="space-y-4">
                <div class="text-left">
                  <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-1">
                    Email Address
                  </label>
                  <input
                    type="email"
                    id="loginEmail"
                    class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                    placeholder="Enter your email address"
                    required
                  />
                </div>
                <div class="text-left">
                  <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">
                    Password
                  </label>
                  <input
                    type="password"
                    id="loginPassword"
                    class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                    placeholder="Enter your password"
                    required
                  />
                </div>
                <div class="flex items-center justify-between">
                  <div class="flex items-center">
                    <input
                      type="checkbox"
                      id="rememberMe"
                      class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                    />
                    <label for="rememberMe" class="ml-2 block text-sm text-gray-700">
                      Remember me
                    </label>
                  </div>
                  <!-- Updated Forgot Password link to trigger modal -->
                  <button
                    id="forgotPasswordBtn"
                    type="button"
                    class="text-sm text-indigo-600 hover:text-indigo-800"
                  >
                    Forgot password?
                  </button>
                </div>
                <button
                  type="submit"
                  class="w-full gradient-bg text-white py-3 px-4 rounded-lg hover:opacity-90 transition-opacity font-medium"
                >
                  Log In
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Forgot Password Modal -->
      <div
        id="forgotPasswordModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
      >
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold text-gray-800">Reset Password</h3>
            <button id="closeForgotModal" class="text-gray-500 hover:text-gray-700">
              <img
                src="https://cdn-icons-png.flaticon.com/512/1828/1828774.png"
                alt="Close"
                class="w-6 h-6"
              />
            </button>
          </div>
          <form id="forgotPasswordForm" class="space-y-4">
            <div>
              <label for="forgotEmail" class="block text-sm font-medium text-gray-700 mb-1">
                Enter your registered email
              </label>
              <input
                type="email"
                id="forgotEmail"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                placeholder="Email address"
                required
              />
            </div>
            <div id="newPasswordContainer" class="hidden space-y-4">
              <div>
                <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-1">
                  New Password
                </label>
                <input
                  type="password"
                  id="newPassword"
                  class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                  placeholder="Enter new password"
                  minlength="6"
                />
                <p class="text-xs text-gray-500 mt-1">
                  Password must be at least 6 characters
                </p>
              </div>
              <div>
                <label for="confirmNewPassword" class="block text-sm font-medium text-gray-700 mb-1">
                  Confirm New Password
                </label>
                <input
                  type="password"
                  id="confirmNewPassword"
                  class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                  placeholder="Confirm new password"
                  minlength="6"
                />
              </div>
            </div>
            <div class="flex justify-end space-x-3 pt-2">
              <button
                type="button"
                id="cancelForgot"
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
              >
                Cancel
              </button>
              <button
                type="submit"
                id="forgotSubmit"
                class="gradient-bg text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity"
              >
                Next
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Welcome Screen -->
      <div id="welcomeScreen" class="hidden">
        <div class="max-w-3xl mx-auto bg-white rounded-xl shadow-md p-8 mb-8 text-center">
          <div class="mb-6 flex justify-center">
            <img
              src="https://cdn-icons-png.flaticon.com/512/1946/1946436.png"
              alt="Goals Icon"
              class="w-16 h-16"
            />
          </div>
          <h2 class="text-3xl font-bold text-gray-800 mb-4">
            Welcome to Dream Tracker
          </h2>
          <p class="text-gray-600 mb-8">
            Plan and track your savings and expenses with your family or roommates.
          </p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-indigo-50 p-6 rounded-lg">
              <h3 class="text-lg font-semibold text-indigo-700 mb-2">
                Create Multiple Goals & Savings
              </h3>
              <p class="text-gray-600">Save for a home, car, electronics, or any other purchase</p>
            </div>
            <div class="bg-indigo-50 p-6 rounded-lg">
              <h3 class="text-lg font-semibold text-indigo-700 mb-2">
                Track All Expenses
              </h3>
              <p class="text-gray-600">
                Record bills, rent, groceries, fuel, travel, and more
              </p>
            </div>
          </div>
          <button
            id="getStartedBtn"
            class="gradient-bg text-white py-3 px-8 rounded-lg hover:opacity-90 transition-opacity font-medium text-lg"
          >
            Get Started
          </button>
        </div>
      </div>

      <!-- Household Setup -->
      <div id="householdSetup" class="hidden">
        <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-md p-6 mb-8">
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">Set Up Your Household</h2>
          <p class="text-gray-600 mb-6">
            Create your household and add members who will contribute to your savings goals.
          </p>
          <form id="householdForm" class="space-y-6">
            <div>
              <label for="householdName" class="block text-sm font-medium text-gray-700 mb-1">
                Household Name
              </label>
              <input
                type="text"
                id="householdName"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                placeholder="e.g., Smith Family or Apartment 4B"
                required
              />
            </div>
            <div>
              <label for="primaryMemberName" class="block text-sm font-medium text-gray-700 mb-1">
                Your Name (Primary Member)
              </label>
              <input
                type="text"
                id="primaryMemberName"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                placeholder="Enter your name"
                required
              />
            </div>
            <div>
              <label for="primaryMemberIncome" class="block text-sm font-medium text-gray-700 mb-1">
                Your Monthly Income
              </label>
              <div class="relative">
                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">₹</span>
                <input
                  type="number"
                  id="primaryMemberIncome"
                  class="input-field w-full pl-8 px-4 py-2 border rounded-lg focus:outline-none"
                  placeholder="Enter your monthly income"
                  required
                />
              </div>
            </div>
            <div id="householdMembers" class="space-y-4">
              <!-- Additional household members will be added here -->
            </div>
            <div class="flex justify-between">
              <button
                type="button"
                id="addHouseholdMember"
                class="text-indigo-600 hover:text-indigo-800 flex items-center"
              >
                <img
                  src="https://cdn-icons-png.flaticon.com/512/323/323296.png"
                  alt="Add Member"
                  class="w-5 h-5 mr-1"
                />
                Add Household Member
              </button>
            </div>
            <button
              type="submit"
              class="w-full gradient-bg text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity font-medium"
            >
              Continue to Add Goals
            </button>
          </form>
        </div>
      </div>

      <!-- Goals & Savings Setup -->
      <div id="goalsSetup" class="hidden">
        <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-md p-6 mb-8">
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">Set Your Savings Goals</h2>
          <p class="text-gray-600 mb-6">Add items you want to save for and their details.</p>
          <form id="goalsForm" class="space-y-6">
            <div id="goalsList" class="space-y-6">
              <!-- Goal items will be added here -->
              <div class="goal-item border border-gray-200 rounded-lg p-4 relative">
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-lg font-medium text-gray-800">Goal #1</h3>
                  <button type="button" class="remove-goal hidden">
                    <img
                      src="https://cdn-icons-png.flaticon.com/512/1828/1828774.png"
                      alt="Remove Goal"
                      class="w-5 h-5"
                    />
                  </button>
                </div>
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Item Category</label>
                    <select
                      class="goal-category input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                      required
                    >
                      <option value="">Select a category</option>
                      <option value="home">Home/Property</option>
                      <option value="car">Vehicle</option>
                      <option value="electronics">Electronics</option>
                      <option value="furniture">Furniture</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
                    <input
                      type="text"
                      class="goal-name input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                      placeholder="e.g., New Home, Car, TV, etc."
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Total Cost</label>
                    <div class="relative">
                      <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">₹</span>
                      <input
                        type="number"
                        class="goal-cost input-field w-full pl-8 px-4 py-2 border rounded-lg focus:outline-none"
                        placeholder="Enter the total cost"
                        required
                      />
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Target Date</label>
                    <input
                      type="date"
                      class="goal-date input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Bank Name</label>
                    <input
                      type="text"
                      class="goal-bank input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                      placeholder="Bank where saving"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Contributors</label>
                    <div class="goal-contributors flex flex-wrap gap-2"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="flex justify-between">
              <button
                type="button"
                id="addGoalBtn"
                class="text-indigo-600 hover:text-indigo-800 flex items-center"
              >
                <img
                  src="https://cdn-icons-png.flaticon.com/512/323/323296.png"
                  alt="Add Goal"
                  class="w-5 h-5 mr-1"
                />
                Add Another Goal
              </button>
            </div>
            <button
              type="submit"
              class="w-full gradient-bg text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity font-medium"
            >
              Create Dashboard
            </button>
          </form>
        </div>
      </div>

<!-- Dashboard -->
<div id="dashboard" class="hidden">

  <!-- Summary Cards Row: Now 5 columns! -->
  <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-6">
    <!-- Total Savings Card -->
    <div class="card bg-white rounded-xl shadow-md p-4 flex flex-col justify-between">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-base font-semibold text-gray-800">Total Savings</h3>
        <img src="https://cdn-icons-png.flaticon.com/512/18157/18157886.png" alt="Savings Icon" class="w-10 h-10" />
      </div>
      <div class="flex flex-col">
        <span id="totalSavings" class="text-2xl font-bold text-gray-900">₹0</span>
        <div class="flex justify-between mt-1">
          <span class="text-xs text-gray-500">Across all goals</span>
          <span id="totalGoals" class="text-xs text-gray-500">0 goals</span>
        </div>
      </div>
    </div>
    <!-- Household Income Card -->
    <div class="card bg-white rounded-xl shadow-md p-4 flex flex-col justify-between">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-base font-semibold text-gray-800">Household Income</h3>
        <img src="https://cdn-icons-png.flaticon.com/512/5002/5002078.png" alt="Income Icon" class="w-10 h-10" />
      </div>
      <div class="flex flex-col">
        <span id="householdIncome" class="text-2xl font-bold text-gray-900">₹0</span>
        <div class="flex justify-between mt-1">
          <span class="text-xs text-gray-500">Monthly</span>
          <span id="householdMemberCount" class="text-xs text-gray-500">0 members</span>
        </div>
      </div>
    </div>
    <!-- Net Income Card -->
    <div class="card bg-white rounded-xl shadow-md p-4 flex flex-col justify-between">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-base font-semibold text-gray-800">Net Income</h3>
        <img src="https://cdn-icons-png.flaticon.com/512/2655/2655375.png" alt="Net Icon" class="w-10 h-10" />
      </div>
      <div class="flex flex-col">
        <span id="netIncome" class="text-2xl font-bold text-gray-900">₹0</span>
        <div class="flex justify-between mt-1">
          <span class="text-xs text-gray-500">Income - Expenses</span>
        </div>
      </div>
    </div>
    <!-- Income Breakdown Card -->
    <div class="card bg-white rounded-xl shadow-md p-4 flex flex-col justify-between">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-base font-semibold text-gray-800">Income Breakdown</h3>
        <img src="https://cdn-icons-png.flaticon.com/512/10243/10243520.png" alt="Breakdown Icon" class="w-10 h-10" />
      </div>
      <div class="flex flex-col space-y-1">
        <span id="dailyIncome" class="text-lg font-bold text-gray-900">₹0 / day</span>
        <span id="monthlyRecommendation" class="text-xs text-gray-500">Recommended: ₹0 / month</span>
        <span id="leftoverIncome" class="text-xs text-green-600 font-semibold"></span>
      </div>
    </div>
    <!-- Total Expenses Card (moved to the 5th position in top row) -->
    <div class="card bg-white rounded-xl shadow-md p-4 flex flex-col justify-center">
      <div class="flex items-center mb-2">
        <img src="https://cdn-icons-png.flaticon.com/512/6553/6553062.png" alt="Expense Icon" class="w-10 h-10 mr-2" />
        <h3 class="text-base font-semibold text-gray-800">Total Expenses</h3>
      </div>
      <span id="totalExpenses" class="text-2xl font-bold text-gray-900 mb-1 block">₹0</span>
      <div class="text-xs text-gray-500 mb-1">All categories</div>
      <div class="text-xs text-gray-500"><span id="expenseCategoriesCount">0</span> categories</div>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
  <!-- Income vs Expenses Pie Chart Card -->
  <div class="card bg-white rounded-xl shadow-md p-4 flex flex-col items-center justify-center"
       style="min-width: 240px;">
    <h3 class="text-base font-semibold text-gray-800 mb-2">Income vs Expenses</h3>
    <div class="flex flex-col items-center justify-center">
      <canvas id="incomeExpensesPie" width="140" height="140"></canvas>
      <div id="pieLegend" class="mt-2"></div>
    </div>
  </div>
  <!-- Monthly Expenses Trend -->
  <div class="card bg-white rounded-xl shadow-md p-4 flex flex-col items-center justify-center"
       style="min-width: 240px;">
    <h3 class="text-base font-semibold text-gray-800 mb-2">Monthly Expenses Trend</h3>
    <canvas id="monthlyExpensesChart" width="220" height="120"></canvas>
  </div>
  <!-- Expenses by Category -->
  <div class="card bg-white rounded-xl shadow-md p-4 flex flex-col items-center justify-center"
       style="min-width: 240px;">
    <h3 class="text-base font-semibold text-gray-800 mb-2">Expenses by Category</h3>
    <canvas id="expenseCategoryChart" width="220" height="120"></canvas>
    </div>
  </div>



        <!-- Next Goals Due Card -->
        <div class="card bg-white rounded-xl shadow-md p-4 mb-8">
            <div class="flex items-center justify-between mb-2">
            <h3 class="text-base font-semibold text-gray-800">Next Goals Due</h3>
            <img src="https://cdn-icons-png.flaticon.com/512/2921/2921222.png" alt="Clock Icon" class="w-10 h-10" />
            </div>
            <div id="nextGoalsContainer" class="space-y-2 max-h-32 overflow-y-auto text-sm text-gray-700">
            <p class="text-gray-500">No goals yet.</p>
            </div>
        </div>

            <!-- Overall Savings & Expense Status (Compact) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div id="overallStatusCard" class="card bg-white rounded-xl shadow-md p-3">
                <div class="flex items-center justify-between mb-2">
                <h3 class="text-sm font-semibold text-gray-800">Overall Savings Status</h3>
                <img
                    src="https://cdn-icons-png.flaticon.com/512/7960/7960488.png"
                    alt="Checklist Icon"
                    class="w-10 h-10"
                />
                </div>
                <div class="space-y-1 text-xs text-gray-700">
                <div class="flex justify-between">
                    <span>Total Cost</span>
                    <span id="overallTotalCost" class="font-medium text-gray-900">₹0</span>
                </div>
                <div class="flex justify-between">
                    <span>Saved So Far</span>
                    <span id="overallSaved" class="font-medium text-gray-900">₹0</span>
                </div>
                <div class="flex justify-between">
                    <span>Remaining</span>
                    <span id="overallRemaining" class="font-medium text-gray-900">₹0</span>
                </div>
                </div>
            </div>
            <div id="overallExpenseCard" class="card bg-white rounded-xl shadow-md p-3">
                <div class="flex items-center justify-between mb-2">
                <h3 class="text-sm font-semibold text-gray-800">Overall Expense Status</h3>
                <img
                    src="https://cdn-icons-png.flaticon.com/512/781/781831.png"
                    alt="Expense Chart Icon"
                    class="w-10 h-10"
                />
                </div>
                <div class="space-y-1 text-xs text-gray-700">
                <div class="flex justify-between">
                    <span>Total Spent</span>
                    <span id="overallExpenseAmount" class="font-medium text-gray-900">₹0</span>
                </div>
                <div class="flex justify-between">
                    <span>Categories</span>
                    <span id="overallExpenseCats" class="font-medium text-gray-900">0</span>
                </div>
                </div>
            </div>
            </div>

            <!-- Goals Section -->
            <div class="mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-800">Your Savings Goals</h2>
                <button
                id="addNewGoalBtn"
                class="gradient-bg text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity text-sm font-medium"
                >
                Add New Goal
                </button>
            </div>
            <div id="goalCards" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
            </div>

            <!-- Recent Activity (Tabs: Savings / Expenses) -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold text-gray-800">Recent Activity</h3>
                <div>
                <button
                    id="addSavingsBtn"
                    class="gradient-bg text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity text-sm font-medium mr-2"
                >
                    Add Savings
                </button>
                <button
                    id="addExpenseBtn"
                    class="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-opacity text-sm font-medium"
                >
                    Add Expense
                </button>
                </div>
            </div>
            <div>
                <!-- Tab Buttons -->
                <div class="flex space-x-4 border-b mb-4">
                <button id="tabSavings" class="pb-2 border-b-2 border-indigo-600 text-indigo-600 font-medium">
                    Savings
                </button>
                <button id="tabExpenses" class="pb-2 text-gray-500 hover:text-gray-700">
                    Expenses
                </button>
                </div>
                <!-- Savings Table -->
                <div id="savingsActivity" class="">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                            Date
                        </th>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                            Member
                        </th>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                            Goal
                        </th>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                            Amount
                        </th>
                        </tr>
                    </thead>
                    <tbody id="activityHistorySavings" class="bg-white divide-y divide-gray-200">
                        <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="4">
                            No savings activity recorded yet
                        </td>
                        </tr>
                    </tbody>
                    </table>
                </div>
                </div>
                <!-- Expenses Table -->
                <div id="expensesActivity" class="hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                            Date
                        </th>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                            Category
                        </th>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                            Subcategory
                        </th>
                        <th
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                        >
                            Amount
                        </th>
                        <th 
                            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                            >
                            Delete
                        </th>
                        </tr>
                    </thead>
                    <tbody id="activityHistoryExpenses" class="bg-white divide-y divide-gray-200">
                        <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="4">
                            No expenses recorded yet
                        </td>
                        </tr>
                    </tbody>
                    </table>
                </div>
                </div>
            </div>
            </div>

            <!-- Household Members -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold text-gray-800">Household Members</h3>
                <button
                id="manageMembersBtn"
                class="text-indigo-600 hover:text-indigo-800 py-2 px-4 border border-indigo-600 rounded-lg transition-colors text-sm font-medium"
                >
                Manage Members
                </button>
            </div>
            <div
                id="householdMembersList"
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
            ></div>
            </div>
        </div>
        </main>

        <!-- Footer -->
        <footer class="bg-white py-4 border-t">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>© 2025 Dream Tracker. All rights reserved.</p>
        </div>
        </footer>
    </div>

    <!-- Add Savings Modal -->
    <div
        id="savingsModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Add Savings</h3>
        <form id="addSavingsForm" class="space-y-4">
            <div>
            <label for="savingsMember" class="block text-sm font-medium text-gray-700 mb-1">
                Contributor
            </label>
            <select
                id="savingsMember"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                required
            >
                <!-- Members will be added here -->
            </select>
            </div>
            <div>
            <label for="savingsGoal" class="block text-sm font-medium text-gray-700 mb-1">
                Goal
            </label>
            <select
                id="savingsGoal"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                required
            >
                <!-- Goals will be added here -->
            </select>
            </div>
            <div>
            <label for="savingsAmount" class="block text-sm font-medium text-gray-700 mb-1">
                Amount
            </label>
            <div class="relative">
                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">₹</span>
                <input
                type="number"
                id="savingsAmount"
                class="input-field w-full pl-8 px-4 py-2 border rounded-lg focus:outline-none"
                required
                />
            </div>
            </div>
            <div>
            <label for="savingsDate" class="block text-sm font-medium text-gray-700 mb-1">
                Date
            </label>
            <input
                type="date"
                id="savingsDate"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                required
            />
            </div>
            <div>
            <label for="savingsNotes" class="block text-sm font-medium text-gray-700 mb-1">
                Notes (Optional)
            </label>
            <textarea
                id="savingsNotes"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                rows="2"
            ></textarea>
            </div>
            <div class="flex justify-end space-x-3 pt-2">
            <button
                type="button"
                id="cancelSavings"
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
            >
                Cancel
            </button>
            <button
                type="submit"
                class="gradient-bg text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity"
            >
                Add
            </button>
            </div>
        </form>
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div
        id="expenseModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 overflow-y-auto max-h-screen">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Add Expense</h3>
        <form id="addExpenseForm" class="space-y-4">
            <div>
            <label for="expenseCategory" class="block text-sm font-medium text-gray-700 mb-1">
                Expense Category
            </label>
            <select
                id="expenseCategory"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                required
            >
                <option value="">Select Category</option>
                <option value="Bills">Bills</option>
                <option value="Rent">Rent</option>
                <option value="Kitchen">Kitchen Expenses</option>
                <option value="Garage">Garage Expenses</option>
                <option value="Travel">Travel & Transportation</option>
                <option value="Shopping">Shopping</option>
                <option value="Other">Other</option>
                <option value="Custom">Custom Category</option>
            </select>
            </div>
            <div id="subCategoryContainer">
            <label for="expenseSubcategory" class="block text-sm font-medium text-gray-700 mb-1">
                Expense Subcategory
            </label>
            <select
                id="expenseSubcategory"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                required
            >
                <option value="">Select Subcategory</option>
            </select>
            </div>
            <div id="customExpenseCategoryContainer" class="hidden">
            <label for="customExpenseCategory" class="block text-sm font-medium text-gray-700 mb-1">
                Custom Category Name
            </label>
            <input
                type="text"
                id="customExpenseCategory"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                placeholder="Enter custom category"
            />
            </div>
            <div id="customExpenseSubcategoryContainer" class="hidden">
            <label for="customExpenseSubcategory" class="block text-sm font-medium text-gray-700 mb-1">
                Custom Subcategory Name
            </label>
            <input
                type="text"
                id="customExpenseSubcategory"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                placeholder="Enter custom subcategory"
            />
            </div>
            <div>
            <label for="expenseAmount" class="block text-sm font-medium text-gray-700 mb-1">
                Amount
            </label>
            <div class="relative">
                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">₹</span>
                <input
                type="number"
                id="expenseAmount"
                class="input-field w-full pl-8 px-4 py-2 border rounded-lg focus:outline-none"
                required
                />
            </div>
            </div>
            <div>
            <label for="expenseDate" class="block text-sm font-medium text-gray-700 mb-1">
                Date
            </label>
            <input
                type="date"
                id="expenseDate"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                required
            />
            </div>
            <div>
            <label for="expenseNote" class="block text-sm font-medium text-gray-700 mb-1">
                Note (Optional)
            </label>
            <textarea
                id="expenseNote"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                rows="2"
            ></textarea>
            </div>
            <div class="flex justify-end space-x-3 pt-2">
            <button
                type="button"
                id="cancelExpense"
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
            >
                Cancel
            </button>
            <button
                type="submit"
                class="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-opacity"
            >
                Add Expense
            </button>
            </div>
        </form>
        </div>
    </div>

    <!-- Add Goal Modal -->
<div id="goalModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
    <div class="flex justify-between items-center mb-4">
      <h3 id="goalModalTitle" class="text-xl font-semibold text-gray-800">
        Add New Goal
      </h3>
      <button type="button" id="closeGoalModalBtn" class="text-gray-500 hover:text-gray-700">
        <img
          src="https://cdn-icons-png.flaticon.com/512/1828/1828774.png"
          alt="Close"
          class="w-6 h-6"
        />
      </button>
    </div>
    <form id="addGoalForm" class="space-y-4">
            <input type="hidden" id="modalEditGoalId" value="" />
            <div>
            <label for="modalGoalCategory" class="block text-sm font-medium text-gray-700 mb-1">
                Item Category
            </label>
            <select
                id="modalGoalCategory"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                required
            >
                <option value="">Select a category</option>
                <option value="home">Home/Property</option>
                <option value="car">Vehicle</option>
                <option value="electronics">Electronics</option>
                <option value="furniture">Furniture</option>
                <option value="other">Other</option>
            </select>
            </div>
            <div>
            <label for="modalGoalName" class="block text-sm font-medium text-gray-700 mb-1">
                Item Name
            </label>
            <input
                type="text"
                id="modalGoalName"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                placeholder="e.g., New Home, Car, TV, etc."
                required
            />
            </div>
            <div>
            <label for="modalGoalCost" class="block text-sm font-medium text-gray-700 mb-1">
                Total Cost
            </label>
            <div class="relative">
                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">₹</span>
                <input
                type="number"
                id="modalGoalCost"
                class="input-field w-full pl-8 px-4 py-2 border rounded-lg focus:outline-none"
                placeholder="Enter the total cost"
                required
                />
            </div>
            </div>
            <div>
            <label for="modalGoalDate" class="block text-sm font-medium text-gray-700 mb-1">
                Target Date
            </label>
            <input
                type="date"
                id="modalGoalDate"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                required
            />
            </div>
            <div>
            <label for="modalGoalBank" class="block text-sm font-medium text-gray-700 mb-1">
                Bank Name
            </label>
            <input
                type="text"
                id="modalGoalBank"
                class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                placeholder="Bank where saving"
                required
            />
            </div>
            <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Contributors</label>
            <div id="modalGoalContributors" class="space-y-2"></div>
            </div>
            <div class="flex justify-end space-x-3 pt-2">
            <button
                type="button"
                id="cancelGoal"
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
            >
                Cancel
            </button>
            <button
                type="submit"
                class="gradient-bg text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity"
            >
                Add Goal
            </button>
            </div>
        </form>
        </div>
    </div>

    <!-- Manage Members Modal -->
    <div
        id="membersModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">Manage Household Members</h3>
        <div class="space-y-4">
            <div id="membersList" class="space-y-3 max-h-60 overflow-y-auto">
            <!-- Members will be listed here -->
            </div>
            <form id="addMemberForm" class="pt-4 border-t border-gray-200">
            <h4 class="text-md font-medium text-gray-700 mb-3">Add New Member</h4>
            <div class="space-y-4">
                <div>
                <label for="newMemberName" class="block text-sm font-medium text-gray-700 mb-1">
                    Name
                </label>
                <input
                    type="text"
                    id="newMemberName"
                    class="input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
                    placeholder="Enter member name"
                    required
                />
                </div>
                <div>
                <label for="newMemberIncome" class="block text-sm font-medium text-gray-700 mb-1">
                    Monthly Income
                </label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">₹</span>
                    <input
                    type="number"
                    id="newMemberIncome"
                    class="input-field w-full pl-8 px-4 py-2 border rounded-lg focus:outline-none"
                    placeholder="Enter monthly income"
                    required
                    />
                </div>
                </div>
                <button
                type="submit"
                class="w-full gradient-bg text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity"
                >
                Add Member
                </button>
            </div>
            </form>
            <div class="flex justify-end pt-4">
            <button
                type="button"
                id="closeMembersModal"
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
            >
                Close
            </button>
            </div>
        </div>
        </div>
    </div>

    <!-- Goal Details Modal -->
    <div
        id="goalDetailsModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
        <div class="bg-white rounded-xl p-6 w-full max-w-2xl mx-4">
        <div class="flex justify-between items-center mb-4">
            <h3 id="detailsGoalName" class="text-xl font-semibold text-gray-800">Goal Details</h3>
            <button id="closeGoalDetails" class="text-gray-500 hover:text-gray-700">
            <img
                src="https://cdn-icons-png.flaticon.com/512/1828/1828774.png"
                alt="Close"
                class="w-6 h-6"
            />
            </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div>
            <p class="text-sm text-gray-500 mb-1">Category</p>
            <p id="detailsGoalCategory" class="text-lg font-medium text-gray-800">-</p>
            </div>
            <div>
            <p class="text-sm text-gray-500 mb-1">Total Cost</p>
            <p id="detailsGoalCost" class="text-lg font-medium text-gray-800">₹0</p>
            </div>
            <div>
            <p class="text-sm text-gray-500 mb-1">Current Savings</p>
            <p id="detailsGoalSavings" class="text-lg font-medium text-gray-800">₹0</p>
            </div>
            <div>
            <p class="text-sm text-gray-500 mb-1">Target Date</p>
            <p id="detailsGoalDate" class="text-lg font-medium text-gray-800">-</p>
            </div>
            <div>
            <p class="text-sm text-gray-500 mb-1">Bank Name</p>
            <p id="detailsGoalBank" class="text-lg font-medium text-gray-800">-</p>
            </div>
        </div>

        <div class="mb-6">
            <p class="text-sm text-gray-500 mb-2">Progress</p>
            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-1">
            <div
                id="detailsGoalProgress"
                class="progress-bar bg-indigo-600 h-2.5 rounded-full"
                style="width: 0%"
            ></div>
            </div>
            <div class="flex justify-between">
            <p id="detailsGoalPercentage" class="text-xs text-gray-500">0%</p>
            <p id="detailsGoalRemaining" class="text-xs text-gray-500">₹0 remaining</p>
            </div>
        </div>

        <div class="mb-6">
            <p class="text-sm text-gray-500 mb-2">Contributors</p>
            <div id="detailsGoalContributors" class="flex flex-wrap gap-2">
            <!-- Contributors will be added here -->
            </div>
        </div>

        <div class="mb-6">
            <p class="text-sm text-gray-500 mb-2">Savings History</p>
            <div class="overflow-x-auto max-h-60 overflow-y-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50 sticky top-0">
                <tr>
                    <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                    Date
                    </th>
                    <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                    Member
                    </th>
                    <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                    Amount
                    </th>
                    <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                    Notes
                    </th>
                </tr>
                </thead>
                <tbody id="detailsGoalHistory" class="bg-white divide-y divide-gray-200">
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="4">
                    No savings recorded yet
                    </td>
                </tr>
                </tbody>
            </table>
            </div>
        </div>

        <div class="flex justify-between mt-6">
            <button
            id="editGoalBtn"
            class="px-4 py-2 border border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50"
            >
            Edit Goal
            </button>
            <button
            id="addGoalSavingsBtn"
            class="gradient-bg text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity"
            >
            Add Savings
            </button>
        </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div
        id="settingsModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
        <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4 overflow-y-auto max-h-screen">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold text-gray-800">Settings</h3>
            <button id="closeSettingsBtn" class="text-gray-500 hover:text-gray-700">
            <img
                src="https://cdn-icons-png.flaticon.com/512/1828/1828774.png"
                alt="Close"
                class="w-6 h-6"
            />
            </button>
        </div>
        <form id="settingsForm" class="space-y-6">
            <!-- Profile Picture Upload -->
            <div>
            <p class="block text-sm font-medium text-gray-700 mb-1">Profile Picture</p>
            <div class="flex items-center space-x-4">
                <img
                id="settingsProfilePicPreview"
                src=""
                alt="Profile Preview"
                class="w-16 h-16 rounded-full object-cover hidden"
                />
                <div id="settingsAvatarInitial" class="contributor-avatar">G</div>
                <button
                type="button"
                id="changeProfilePicBtn"
                class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-md hover:bg-indigo-200"
                >
                Change
                </button>
                <input type="file" id="profilePicInput" accept="image/*" />
            </div>
            </div>

            <!-- Logout -->
            <div>
            <button
                type="button"
                id="logoutInSettings"
                class="w-full py-2 px-4 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 text-center"
            >
                Logout
            </button>
            </div>

        <!-- Edit Goals Section -->
        <div>
          <p class="block text-sm font-medium text-gray-700 mb-1">Edit Existing Goals</p>
          <div id="settingsGoalsList" class="space-y-4 max-h-60 overflow-y-auto border border-gray-200 rounded-lg p-3">
            <!-- Each existing goal will appear here with editable fields -->
          </div>
        </div>

        <div class="flex justify-end space-x-3 pt-2">
          <button
            type="button"
            id="cancelSettings"
            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="gradient-bg text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity"
          >
            Save Settings
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Notification -->
  <div
    id="notification"
    class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 transform transition-transform duration-300 translate-y-20 opacity-0 flex items-center"
  >
    <div id="notificationIcon" class="mr-3 text-green-500">
      <img
        src="https://cdn-icons-png.flaticon.com/512/190/190411.png"
        alt="Success Icon"
        class="w-6 h-6"
      />
    </div>
    <p id="notificationText" class="text-gray-800"></p>
  </div>
</div>
<script>

document.addEventListener('DOMContentLoaded', function () {
  // Always hide dashboard at first load
  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('userDisplay').classList.add('hidden');
  document.getElementById('logoutBtn').classList.add('hidden');
  document.getElementById('openSettingsBtn').classList.add('hidden');
  document.getElementById('closeGoalModalBtn').addEventListener('click', closeGoalModal);
  document.getElementById('cancelGoal').addEventListener('click', closeGoalModal);
  initApp();
});
    // App state (including settings, profilePic, expenses)
    const appState = {
      auth: {
        isLoggedIn: false,
        currentUser: null,
        users: []
      },
      household: {
        name: '',
        members: []
      },
      goals: [],           // savings goals
      savings: [],         // savings entries
      expenses: [],        // expense entries
      currentUser: null,
      theme: 'light',
      settings: {
        profilePic: ''    // Base64 string
      }
    };

function showAuthScreen() {
  document.getElementById('authScreen').classList.remove('hidden');
  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('welcomeScreen').classList.add('hidden');
  document.getElementById('householdSetup').classList.add('hidden');
  document.getElementById('goalsSetup').classList.add('hidden');
  document.getElementById('userDisplay').classList.add('hidden');
  document.getElementById('logoutBtn').classList.add('hidden');
  document.getElementById('openSettingsBtn').classList.add('hidden');    // ← hide Settings
}

function showWelcomeScreen() {
  document.getElementById('authScreen').classList.add('hidden');
  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('welcomeScreen').classList.remove('hidden');
  document.getElementById('householdSetup').classList.add('hidden');
  document.getElementById('goalsSetup').classList.add('hidden');
}

function showHouseholdSetup() {
  document.getElementById('authScreen').classList.add('hidden');
  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('welcomeScreen').classList.add('hidden');
  document.getElementById('householdSetup').classList.remove('hidden');
  document.getElementById('goalsSetup').classList.add('hidden');
}

function showGoalsSetup() {
  document.getElementById('authScreen').classList.add('hidden');
  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('welcomeScreen').classList.add('hidden');
  document.getElementById('householdSetup').classList.add('hidden');
  document.getElementById('goalsSetup').classList.remove('hidden');
}

function showDashboard() {
  document.getElementById('authScreen').classList.add('hidden');
  document.getElementById('dashboard').classList.remove('hidden');
  document.getElementById('welcomeScreen').classList.add('hidden');
  document.getElementById('householdSetup').classList.add('hidden');
  document.getElementById('goalsSetup').classList.add('hidden');
}

    // Expense category/subcategory mapping
    const expenseCategories = {
      Bills: ['Credit Card Bills', 'Electricity Bills', 'Mobile/DTH Bills', 'Wi-Fi Bill'],
      Rent: ['House Rent', 'Furniture Rent', 'Maintenance Fee'],
      Kitchen: ['Food', 'Vegetables & Grocery Bills'],
      Garage: ['Fuel', 'Other Expenses'],
      Travel: ['Hotel Bills', 'Travel Bills', 'Food Bills (Travel)'],
      Shopping: ['Shopping Bills'],
      Other: ['Miscellaneous Expenses']
    };

    // DOM Elements
    document.addEventListener('DOMContentLoaded', function () {
      initApp();
    });

    // Initialize the app
    function initApp() {
      // Load data from localStorage if available
      const savedState = localStorage.getItem('dreamTrackerApp');
      if (savedState) {
        try {
          const parsedState = JSON.parse(savedState);
          Object.assign(appState, parsedState);

          if (appState.auth.isLoggedIn) {
            applyProfileDisplay();
            if (appState.household.name && appState.goals.length > 0) {
              showDashboard();
              updateDashboard();
            } else {
              showWelcomeScreen();
            }
          }
        } catch (e) {
          console.error('Error loading saved data:', e);
          localStorage.removeItem('dreamTrackerApp');
        }
      }

      // Set today's date as default for date inputs
      const today = new Date().toISOString().split('T')[0];
      const dateInputs = document.querySelectorAll('input[type="date"]');
      dateInputs.forEach((input) => {
        input.value = today;
      });

      // Auth tab switching
      document.getElementById('signupTab').addEventListener('click', () => {
        document.getElementById('signupTab').classList.add('active');
        document.getElementById('loginTab').classList.remove('active');
        document.getElementById('signupForm').classList.remove('hidden');
        document.getElementById('loginForm').classList.add('hidden');
      });

      document.getElementById('loginTab').addEventListener('click', () => {
        document.getElementById('loginTab').classList.add('active');
        document.getElementById('signupTab').classList.remove('active');
        document.getElementById('loginForm').classList.remove('hidden');
        document.getElementById('signupForm').classList.add('hidden');
      });

      // Auth form submissions
      document.getElementById('userSignupForm').addEventListener('submit', handleSignup);
      document.getElementById('userLoginForm').addEventListener('submit', handleLogin);

      // Event listeners
      document.getElementById('getStartedBtn').addEventListener('click', () => {
        document.getElementById('welcomeScreen').classList.add('hidden');
        document.getElementById('householdSetup').classList.remove('hidden');
      });

      document.getElementById('householdForm').addEventListener('submit', handleHouseholdFormSubmit);
      document.getElementById('addHouseholdMember').addEventListener('click', addHouseholdMemberField);
      document.getElementById('goalsForm').addEventListener('submit', handleGoalsFormSubmit);
      document.getElementById('addGoalBtn').addEventListener('click', addGoalField);

      document.getElementById('addSavingsBtn').addEventListener('click', openSavingsModal);
      document.getElementById('cancelSavings').addEventListener('click', closeSavingsModal);
      document.getElementById('addSavingsForm').addEventListener('submit', handleAddSavings);

      document.getElementById('addExpenseBtn').addEventListener('click', openExpenseModal);
      document.getElementById('cancelExpense').addEventListener('click', closeExpenseModal);
      document.getElementById('addExpenseForm').addEventListener('submit', handleAddExpense);

      document.getElementById('addNewGoalBtn').addEventListener('click', openGoalModal);
      document.getElementById('cancelGoal').addEventListener('click', closeGoalModal);
      document.getElementById('addGoalForm').addEventListener('submit', handleAddGoal);

      document.getElementById('manageMembersBtn').addEventListener('click', openMembersModal);
      document.getElementById('closeMembersModal').addEventListener('click', closeMembersModal);
      document.getElementById('addMemberForm').addEventListener('submit', handleAddMember);

      document.getElementById('closeGoalDetails').addEventListener('click', closeGoalDetailsModal);
      document.getElementById('editGoalBtn').addEventListener('click', handleEditGoal);
      document.getElementById('addGoalSavingsBtn').addEventListener('click', handleAddGoalSavings);

      // Tab switching for Recent Activity
      document.getElementById('tabSavings').addEventListener('click', () => {
        document.getElementById('tabSavings').classList.add('border-indigo-600', 'text-indigo-600');
        document.getElementById('tabExpenses').classList.remove('border-indigo-600', 'text-indigo-600');
        document.getElementById('savingsActivity').classList.remove('hidden');
        document.getElementById('expensesActivity').classList.add('hidden');
      });
      document.getElementById('tabExpenses').addEventListener('click', () => {
        document.getElementById('tabExpenses').classList.add('border-indigo-600', 'text-indigo-600');
        document.getElementById('tabSavings').classList.remove('border-indigo-600', 'text-indigo-600');
        document.getElementById('expensesActivity').classList.remove('hidden');
        document.getElementById('savingsActivity').classList.add('hidden');
      });

      // Expense category change
      document.getElementById('expenseCategory').addEventListener('change', handleExpenseCategoryChange);

      // Theme toggle
      document.getElementById('toggleTheme').addEventListener('click', toggleTheme);

      // Settings panel open/close
      document.getElementById('openSettingsBtn').addEventListener('click', openSettingsModal);
      document.getElementById('closeSettingsBtn').addEventListener('click', closeSettingsModal);
      document.getElementById('cancelSettings').addEventListener('click', closeSettingsModal);
      document.getElementById('settingsForm').addEventListener('submit', handleSettingsSubmit);

      // Profile pic change
      document.getElementById('changeProfilePicBtn').addEventListener('click', () => {
        document.getElementById('profilePicInput').click();
      });
      document.getElementById('profilePicInput').addEventListener('change', handleProfilePicUpload);

      // Logout buttons
      document.getElementById('logoutBtn').addEventListener('click', performLogout);
      document.getElementById('logoutInSettings').addEventListener('click', performLogout);

      // Forgot Password handlers
      document.getElementById('forgotPasswordBtn').addEventListener('click', openForgotModal);
      document.getElementById('closeForgotModal').addEventListener('click', closeForgotModal);
      document.getElementById('cancelForgot').addEventListener('click', closeForgotModal);
      document.getElementById('forgotPasswordForm').addEventListener('submit', handleForgotPassword);

      // If already logged in and household/goals exist, update display
      if (appState.auth.isLoggedIn && appState.household.name) {
        updateUserDisplay(appState.auth.currentUser.name);
      }

      // Start countdown timer interval
      setInterval(updateAllCountdowns, 1000);
    }

    // Authentication functions
    function handleSignup(e) {
      e.preventDefault();

      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;
      const confirmPassword = document.getElementById('signupConfirmPassword').value;
      const termsAgree = document.getElementById('termsAgree').checked;

      // Validation
      if (!name || !email || !password || !confirmPassword) {
        showNotification('Please fill in all fields', 'error');
        return;
      }

      if (password !== confirmPassword) {
        showNotification('Passwords do not match', 'error');
        return;
      }

      if (password.length < 6) {
        showNotification('Password must be at least 6 characters', 'error');
        return;
      }

      if (!termsAgree) {
        showNotification('You must agree to the Terms of Service', 'error');
        return;
      }

      // Check if email already exists
      const emailExists = appState.auth.users.some((user) => user.email === email);
      if (emailExists) {
        showNotification('Email already registered. Please log in.', 'error');
        return;
      }

      // Create new user
      const newUser = {
        id: generateId(),
        name,
        email,
        password // In a real app, this would be hashed
      };

      appState.auth.users.push(newUser);
      appState.auth.isLoggedIn = true;
      appState.auth.currentUser = newUser;

      // Save to localStorage
      saveAppState();

      // Update profile display
      applyProfileDisplay();

      // Show welcome screen
      showWelcomeScreen();

    // Show next appropriate screen:
    if (!appState.household.name) {
        showWelcomeScreen();
    } else if (!appState.goals.length) {
        showGoalsSetup();
    } else {
        showDashboard();
    }

      // Show success notification
      showNotification('Account created successfully! Welcome to Dream Tracker.');

      // Update user display
      updateUserDisplay(newUser.name);

    if (signupSuccessful) {
    showDashboard(); // Or showWelcomeScreen() if you need setup first
  }  

    }

    function handleLogin(e) {
      e.preventDefault();

      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;

      // Find user
      const user = appState.auth.users.find(
        (user) => user.email === email && user.password === password
      );

      if (!user) {
        showNotification('Invalid email or password', 'error');
        return;
      }

      // Log in user
      appState.auth.isLoggedIn = true;
      appState.auth.currentUser = user;

      // Save to localStorage
      saveAppState();

      // Update profile display
      applyProfileDisplay();

      // Show appropriate screen
      if (appState.household.name && appState.goals.length > 0) {
        showDashboard();
        updateDashboard();
      } else {
        showWelcomeScreen();
      }
  // Show next appropriate screen:
  if (!appState.household.name) {
    showWelcomeScreen();
  } else if (!appState.goals.length) {
    showGoalsSetup();
  } else {
    showDashboard();
  }
      // Show success notification
      showNotification(`Welcome back, ${user.name}!`);

      // Update user display
      updateUserDisplay(user.name);
    
  if (loginSuccessful) {
    showDashboard(); // Or showWelcomeScreen() if needed
  }  

    }

function performLogout() {
  appState.auth.isLoggedIn = false;
  appState.auth.currentUser = null;
  saveAppState();
  showAuthScreen();
    }

    function applyProfileDisplay() {
      const imgEl = document.getElementById('profilePic');
      const initialEl = document.getElementById('avatarInitial');
      const previewEl = document.getElementById('settingsProfilePicPreview');
      const settingsInitialEl = document.getElementById('settingsAvatarInitial');

      if (appState.settings.profilePic) {
        imgEl.src = appState.settings.profilePic;
        imgEl.classList.remove('hidden');
        initialEl.classList.add('hidden');

        previewEl.src = appState.settings.profilePic;
        previewEl.classList.remove('hidden');
        settingsInitialEl.classList.add('hidden');
      } else {
        imgEl.classList.add('hidden');
        initialEl.classList.remove('hidden');
        initialEl.textContent = appState.auth.currentUser
          ? appState.auth.currentUser.name.charAt(0).toUpperCase()
          : 'G';
        settingsInitialEl.textContent = appState.auth.currentUser
          ? appState.auth.currentUser.name.charAt(0).toUpperCase()
          : 'G';
        settingsInitialEl.classList.remove('hidden');
        previewEl.classList.add('hidden');
      }

      // Show logout button
      document.getElementById('logoutBtn').classList.remove('hidden');
      // Show settings button once logged in
      document.getElementById('openSettingsBtn').classList.remove('hidden');
    }

    function updateUserDisplay(name) {
      document.getElementById('currentUserName').textContent = name;
      document.getElementById('userDisplay').classList.remove('hidden');
      // Update avatar initial if no picture
      const initialEl = document.getElementById('avatarInitial');
      if (!appState.settings.profilePic) {
        initialEl.textContent = name.charAt(0).toUpperCase();
      }
    }

    function showWelcomeScreen() {
      document.getElementById('authScreen').classList.add('hidden');
      document.getElementById('welcomeScreen').classList.remove('hidden');
      document.getElementById('householdSetup').classList.add('hidden');
      document.getElementById('goalsSetup').classList.add('hidden');
      document.getElementById('dashboard').classList.add('hidden');

      // Show current user in header
      if (appState.auth.currentUser) {
        updateUserDisplay(appState.auth.currentUser.name);
      }
    }

    // Helper functions
    function generateId() {
      return (
        Math.random().toString(36).substring(2, 15) +
        Math.random().toString(36).substring(2, 15)
      );
    }

    function formatNumber(number) {
      return number.toLocaleString('en-IN');
    }

    function formatDate(dateString) {
      const options = { year: 'numeric', month: 'short', day: 'numeric' };
      return new Date(dateString).toLocaleDateString('en-IN', options);
    }

    function formatRelativeDue(daysLeft) {
      if (daysLeft < 0) return 'Past due';
      if (daysLeft === 0) return 'Due Today';
      if (daysLeft === 1) return 'Due Tomorrow';
      if (daysLeft < 7) return `In ${daysLeft} day${daysLeft > 1 ? 's' : ''}`;
      if (daysLeft < 30) {
        const weeks = Math.ceil(daysLeft / 7);
        return `In ${weeks} week${weeks > 1 ? 's' : ''}`;
      }
      const months = Math.ceil(daysLeft / 30);
      return `In ${months} month${months > 1 ? 's' : ''}`;
    }

    function saveAppState() {
      localStorage.setItem('dreamTrackerApp', JSON.stringify(appState));
    }

    function getCategoryDetails(category) {
      const categories = {
        home: {
          imgUrl: 'https://cdn-icons-png.flaticon.com/512/2163/2163350.png',
          colorClass: 'goal-card-home'
        },
        car: {
          imgUrl: 'https://cdn-icons-png.flaticon.com/512/3097/3097182.png',
          colorClass: 'goal-card-car'
        },
        electronics: {
          imgUrl: 'https://cdn-icons-png.flaticon.com/512/1261/1261106.png',
          colorClass: 'goal-card-electronics'
        },
        furniture: {
          imgUrl: 'https://cdn-icons-png.flaticon.com/512/2603/2603741.png',
          colorClass: 'goal-card-furniture'
        },
        other: {
          imgUrl: 'https://cdn-icons-png.flaticon.com/512/6833/6833470.png',
          colorClass: 'goal-card-other'
        }
      };
      return categories[category] || categories.other;
    }

    function getCategoryName(category) {
      const names = {
        home: 'Home/Property',
        car: 'Vehicle',
        electronics: 'Electronics',
        furniture: 'Furniture',
        other: 'Other'
      };
      return names[category] || 'Other';
    }

    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      const notificationText = document.getElementById('notificationText');
      const notificationIcon = document.getElementById('notificationIcon');

      notificationText.textContent = message;

      if (type === 'error') {
        notificationIcon.innerHTML = `
          <img src="https://cdn-icons-png.flaticon.com/512/1828/1828774.png" alt="Error Icon" class="w-6 h-6 text-red-500"/>
        `;
      } else {
        notificationIcon.innerHTML = `
          <img src="https://cdn-icons-png.flaticon.com/512/190/190411.png" alt="Success Icon" class="w-6 h-6 text-green-500"/>
        `;
      }

      notification.classList.remove('translate-y-20', 'opacity-0');
      setTimeout(() => {
        notification.classList.add('translate-y-20', 'opacity-0');
      }, 3000);
    }

    function toggleTheme() {
      const body = document.body;
      if (appState.theme === 'light') {
        body.classList.add('dark-theme');
        appState.theme = 'dark';
      } else {
        body.classList.remove('dark-theme');
        appState.theme = 'light';
      }
      saveAppState();
    }

    // Forgot Password functions
    function openForgotModal() {
      document.getElementById('forgotPasswordModal').classList.remove('hidden');
      // Reset the form fields
      document.getElementById('forgotEmail').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmNewPassword').value = '';
      document.getElementById('newPasswordContainer').classList.add('hidden');
      document.getElementById('forgotSubmit').textContent = 'Next';
    }

    function closeForgotModal() {
      document.getElementById('forgotPasswordModal').classList.add('hidden');
    }

    function handleForgotPassword(e) {
      e.preventDefault();
      const emailInput = document.getElementById('forgotEmail');
      const email = emailInput.value.trim();
      const newPasswordInput = document.getElementById('newPassword');
      const confirmNewPasswordInput = document.getElementById('confirmNewPassword');
      const newPassword = newPasswordInput.value;
      const confirmNewPassword = confirmNewPasswordInput.value;

      // Step 1: Check if we are still in "email" stage or "new password" stage
      if (document.getElementById('newPasswordContainer').classList.contains('hidden')) {
        // Stage 1: Validate email exists
        if (!email) {
          showNotification('Please enter your email address', 'error');
          return;
        }
        const user = appState.auth.users.find((u) => u.email === email);
        if (!user) {
          showNotification('Email not found. Please sign up first.', 'error');
          return;
        }
        // Show new password fields
        document.getElementById('newPasswordContainer').classList.remove('hidden');
        document.getElementById('forgotSubmit').textContent = 'Reset Password';
        return;
      } else {
        // Stage 2: Validate new passwords and update
        if (!newPassword || !confirmNewPassword) {
          showNotification('Please fill in both password fields', 'error');
          return;
        }
        if (newPassword.length < 6) {
          showNotification('Password must be at least 6 characters', 'error');
          return;
        }
        if (newPassword !== confirmNewPassword) {
          showNotification('Passwords do not match', 'error');
          return;
        }
        // Find user again and update password
        const userIndex = appState.auth.users.findIndex((u) => u.email === email);
        if (userIndex === -1) {
          showNotification('Unexpected error: user not found', 'error');
          return;
        }
        appState.auth.users[userIndex].password = newPassword;
        saveAppState();
        showNotification('Password has been reset. Please log in with your new password.');
        closeForgotModal();
      }
    }

    // Form submission handlers
    function handleHouseholdFormSubmit(e) {
      e.preventDefault();

      // Get form values
      appState.household.name = document.getElementById('householdName').value.trim();

      // Add primary member
      const primaryMember = {
        id: generateId(),
        name: document.getElementById('primaryMemberName').value.trim(),
        income: parseFloat(document.getElementById('primaryMemberIncome').value) || 0,
        isPrimary: true
      };

      appState.household.members = [primaryMember];
      appState.currentUser = primaryMember.id;

      // Get additional members
      const memberElements = document.querySelectorAll('.household-member');
      memberElements.forEach((element) => {
        const name = element.querySelector('.member-name').value.trim();
        const income = parseFloat(element.querySelector('.member-income').value) || 0;
        if (name) {
          appState.household.members.push({
            id: generateId(),
            name,
            income,
            isPrimary: false
          });
        }
      });

      // Save to localStorage
      saveAppState();

      // Show goals setup
      showGoalsSetup();
      document.getElementById('householdSetup').classList.add('hidden');
      document.getElementById('goalsSetup').classList.remove('hidden');

      // Update contributors in goal form
      updateGoalContributors();
    }

    function handleGoalsFormSubmit(e) {
      e.preventDefault();

      // Get goals from form
      appState.goals = [];
      const goalItems = document.querySelectorAll('.goal-item');

      goalItems.forEach((item) => {
        const category = item.querySelector('.goal-category').value;
        const name = item.querySelector('.goal-name').value.trim();
        const cost = parseFloat(item.querySelector('.goal-cost').value) || 0;
        const date = item.querySelector('.goal-date').value;
        const bankName = item.querySelector('.goal-bank').value.trim();

        // Get contributors
        const contributors = [];
        const contributorCheckboxes = item.querySelectorAll(
          '.goal-contributor-checkbox:checked'
        );
        contributorCheckboxes.forEach((checkbox) => {
          contributors.push(checkbox.value);
        });

        if (name && cost > 0 && date && contributors.length > 0 && bankName) {
          appState.goals.push({
            id: generateId(),
            category,
            name,
            cost,
            targetDate: date,
            bankName,
            contributors,
            currentSavings: 0
          });
        }
      });

      // Save to localStorage
      saveAppState();

      // Show dashboard
    showDashboard();
      updateDashboard();

      // Show success notification
      showNotification('Your savings goals have been created!');
    }

    function handleAddSavings(e) {
      e.preventDefault();

      const memberId = document.getElementById('savingsMember').value;
      const goalId = document.getElementById('savingsGoal').value;
      const amount = parseFloat(document.getElementById('savingsAmount').value) || 0;
      const date = document.getElementById('savingsDate').value;
      const notes = document.getElementById('savingsNotes').value.trim();

      if (memberId && goalId && amount > 0 && date) {
        // Add to savings history
        appState.savings.push({
          id: generateId(),
          memberId,
          goalId,
          amount,
          date,
          notes
        });

        // Update goal's current savings
        const goalIndex = appState.goals.findIndex((goal) => goal.id === goalId);
        if (goalIndex !== -1) {
          appState.goals[goalIndex].currentSavings += amount;
        }

        // Save to localStorage
        saveAppState();

        // Update UI
        updateDashboard();
        closeSavingsModal();

        // Reset form
        document.getElementById('savingsAmount').value = '';
        document.getElementById('savingsNotes').value = '';

        // Show success notification
        const goalName = appState.goals[goalIndex].name;
        showNotification(`₹${formatNumber(amount)} added to ${goalName}`);
      }
    }

    function handleAddExpense(e) {
      e.preventDefault();

      let category = document.getElementById('expenseCategory').value;
      let subcategory = document.getElementById('expenseSubcategory').value;
      const amount = parseFloat(document.getElementById('expenseAmount').value) || 0;
      const date = document.getElementById('expenseDate').value;
      const note = document.getElementById('expenseNote').value.trim();

      if (category === 'Custom') {
        const customCat = document.getElementById('customExpenseCategory').value.trim();
        const customSubcat = document.getElementById('customExpenseSubcategory').value.trim();
        if (customCat) category = customCat;
        if (customSubcat) subcategory = customSubcat;
      }

      if (category && subcategory && amount > 0 && date) {
        appState.expenses.push({
          id: generateId(),
          category,
          subcategory,
          amount,
          date,
          note
        });

        // Save to localStorage
        saveAppState();

        // Update UI
        updateDashboard();
        closeExpenseModal();

        // Reset form
        document.getElementById('expenseAmount').value = '';
        document.getElementById('expenseNote').value = '';
        document.getElementById('expenseCategory').value = '';
        document.getElementById('expenseSubcategory').innerHTML = '<option value="">Select Subcategory</option>';
        document.getElementById('customExpenseCategoryContainer').classList.add('hidden');
        document.getElementById('customExpenseSubcategoryContainer').classList.add('hidden');

        // Show success notification
        showNotification(`₹${formatNumber(amount)} expense recorded under ${category} › ${subcategory}`);
      }
    }

    function handleExpenseCategoryChange() {
      const cat = document.getElementById('expenseCategory').value;
      const subcatSelect = document.getElementById('expenseSubcategory');
      subcatSelect.innerHTML = '<option value="">Select Subcategory</option>';

      if (cat === 'Custom') {
        document.getElementById('subCategoryContainer').classList.add('hidden');
        document.getElementById('customExpenseCategoryContainer').classList.remove('hidden');
        document.getElementById('customExpenseSubcategoryContainer').classList.remove('hidden');
      } else {
        document.getElementById('subCategoryContainer').classList.remove('hidden');
        document.getElementById('customExpenseCategoryContainer').classList.add('hidden');
        document.getElementById('customExpenseSubcategoryContainer').classList.add('hidden');
        if (expenseCategories[cat]) {
          expenseCategories[cat].forEach((sub) => {
            const opt = document.createElement('option');
            opt.value = sub;
            opt.textContent = sub;
            subcatSelect.appendChild(opt);
          });
        }
      }
    }

function handleAddGoal(e) {
  e.preventDefault();

  // 1️⃣ Read the hidden edit-mode marker
  const editId = document.getElementById('modalEditGoalId').value;

  // 2️⃣ Grab all the form values
  const category = document.getElementById('modalGoalCategory').value;
  const name     = document.getElementById('modalGoalName').value.trim();
  const cost     = parseFloat(document.getElementById('modalGoalCost').value) || 0;
  const date     = document.getElementById('modalGoalDate').value;
  const bankName = document.getElementById('modalGoalBank').value.trim();

  // 3️⃣ Collect contributors
  const contributors = [];
  document.querySelectorAll('#modalGoalContributors input:checked')
    .forEach(cb => contributors.push(cb.value));

  // 4️⃣ Basic validation
  if (!category || !name || cost <= 0 || !date || !bankName || contributors.length === 0) {
    showNotification('Please fill in all fields and select at least one contributor', 'error');
    return;
  }

  if (editId) {
    // ─── UPDATE EXISTING GOAL ───
    const goal = appState.goals.find(g => g.id === editId);
    if (!goal) return;

    Object.assign(goal, {
      category,
      name,
      cost,
      targetDate: date,
      bankName,
      contributors
    });

    saveAppState();
    updateDashboard();
    closeGoalModal();
    showNotification(`Goal "${name}" updated!`);

    // reset edit marker
    document.getElementById('modalEditGoalId').value = '';
    return;
  }

  // ─── CREATE A NEW GOAL ───
  const newGoal = {
    id: generateId(),
    category,
    name,
    cost,
    targetDate: date,
    bankName,
    contributors,
    currentSavings: 0
  };
  appState.goals.push(newGoal);

  saveAppState();
  updateDashboard();
  closeGoalModal();

  // clear form
  document.getElementById('modalAddGoalForm').reset(); // or individually clear fields

  showNotification(`New goal "${name}" has been added!`);
}


    function handleAddMember(e) {
      e.preventDefault();

      const name = document.getElementById('newMemberName').value.trim();
      const income = parseFloat(document.getElementById('newMemberIncome').value) || 0;

      if (name) {
        appState.household.members.push({
          id: generateId(),
          name,
          income,
          isPrimary: false
        });

        // Save to localStorage
        saveAppState();

        // Update UI
        updateDashboard();
        updateMembersList();

        // Reset form
        document.getElementById('newMemberName').value = '';
        document.getElementById('newMemberIncome').value = '';

        // Show success notification
        showNotification(`${name} has been added to your household!`);
      }
    }

    function handleEditGoal() {
  // 1. Get the goal ID from the details modal
  const goalId = document
    .getElementById('goalDetailsModal')
    .getAttribute('data-goal-id');
  const goal = appState.goals.find(g => g.id === goalId);
  if (!goal) return;

  // 2. Populate the “Add/Edit Goal” modal fields
  document.getElementById('modalEditGoalId').value   = goal.id;
  document.getElementById('modalGoalCategory').value = goal.category;
  document.getElementById('modalGoalName').value     = goal.name;
  document.getElementById('modalGoalCost').value     = goal.cost;
  document.getElementById('modalGoalDate').value     = goal.targetDate;
  document.getElementById('modalGoalBank').value     = goal.bankName;

  // 3. Populate the contributor checkboxes
  const container = document.getElementById('modalGoalContributors');
  container.querySelectorAll('input[type=checkbox]').forEach(cb => {
    cb.checked = goal.contributors.includes(cb.value);
  });

  // 4. Close details, open goal modal
  closeGoalDetailsModal();
  document.getElementById('goalModalTitle').textContent = 'Edit Goal';
  openGoalModal();
    }

    function handleAddGoalSavings() {
      const goalId = document.getElementById('goalDetailsModal').getAttribute('data-goal-id');
      if (goalId) {
        document.getElementById('savingsGoal').value = goalId;
        closeGoalDetailsModal();
        openSavingsModal();
        document.getElementById('goalModalTitle').textContent = 'Add New Goal';
      }
    }

    function removeMember(memberId) {
  // 1️⃣ Remove from household
  appState.household.members = appState.household.members.filter(
    member => member.id !== memberId
  );

  // 2️⃣ Also remove from any goal’s contributors
  appState.goals.forEach(goal => {
    goal.contributors = goal.contributors.filter(id => id !== memberId);
  });

  // 3️⃣ Persist & refresh UI
  saveAppState();
  updateDashboard();
  updateMembersList();

  // 4️⃣ Notify
  showNotification('Member removed (and unassigned from any goals).');
    }

    // Settings handlers
    function openSettingsModal() {
      // Populate profile picture preview/initial
      applyProfileDisplay();

      // Populate existing goals for editing
      const list = document.getElementById('settingsGoalsList');
      list.innerHTML = '';
      appState.goals.forEach((goal, idx) => {
        const goalDiv = document.createElement('div');
        goalDiv.className = 'border border-gray-200 rounded-lg p-3';
        goalDiv.innerHTML = `
          <p class="text-sm font-medium text-gray-700 mb-2">Goal ${idx + 1}: ${
          goal.name
        }</p>
          <div class="space-y-2">
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Bank Name</label>
              <input
                type="text"
                class="settings-goal-bank input-field w-full px-3 py-2 border rounded-lg focus:outline-none text-sm"
                data-goal-id="${goal.id}"
                value="${goal.bankName}"
              />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Target Date</label>
              <input
                type="date"
                class="settings-goal-date input-field w-full px-3 py-2 border rounded-lg focus:outline-none text-sm"
                data-goal-id="${goal.id}"
                value="${goal.targetDate}"
              />
            </div>
          </div>
        `;
        list.appendChild(goalDiv);
      });

      document.getElementById('settingsModal').classList.remove('hidden');
    }

    function closeSettingsModal() {
      document.getElementById('settingsModal').classList.add('hidden');
    }

    function handleSettingsSubmit(e) {
      e.preventDefault();

      // Profile pic already handled on upload
      // Update each goal’s bankName and targetDate from the inputs
      const bankInputs = document.querySelectorAll('.settings-goal-bank');
      bankInputs.forEach((input) => {
        const goalId = input.getAttribute('data-goal-id');
        const newBank = input.value.trim();
        const goal = appState.goals.find((g) => g.id === goalId);
        if (goal && newBank) {
          goal.bankName = newBank;
        }
      });

      const dateInputs = document.querySelectorAll('.settings-goal-date');
      dateInputs.forEach((input) => {
        const goalId = input.getAttribute('data-goal-id');
        const newDate = input.value;
        const goal = appState.goals.find((g) => g.id === goalId);
        if (goal && newDate) {
          goal.targetDate = newDate;
        }
      });

      // Save changes
      saveAppState();

      closeSettingsModal();
      showNotification('Settings saved successfully!');
      updateDashboard();
    }

    function handleProfilePicUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        const base64 = e.target.result;
        appState.settings.profilePic = base64;
        saveAppState();
        applyProfileDisplay();
      };
      reader.readAsDataURL(file);
    }

    // UI update functions
    function showDashboard() {
      document.getElementById('authScreen').classList.add('hidden');
      document.getElementById('welcomeScreen').classList.add('hidden');
      document.getElementById('householdSetup').classList.add('hidden');
      document.getElementById('goalsSetup').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      updateCurrentUser();
    }

    function updateCurrentUser() {
      if (appState.auth.currentUser) {
        updateUserDisplay(appState.auth.currentUser.name);
      }
    }

    function updateDashboard() {
      updateSummaryCards();
      updateNextGoalsDueCard();
      updateOverallStatus();
      updateOverallExpenses();
      updateGoalCards();
      updateActivityHistory();
      updateExpenseHistory();
      updateHouseholdMembersList();
    const householdIncome = appState.household.members.reduce((sum, m) => sum + m.income, 0);
    const totalExpenses = appState.expenses.reduce((sum, exp) => sum + exp.amount, 0);
    renderIncomeExpensesPie(householdIncome, totalExpenses); 
    updateCharts();  
        }

  if (incomeExpensesPieChart) incomeExpensesPieChart.destroy();

  incomeExpensesPieChart = new Chart(ctx, {
    type: 'pie',
    data: data,
    options: {
      responsive: false,
      plugins: {
        legend: {
          display: true,
          position: 'bottom'
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.label || '';
              const value = context.parsed;
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const pct = total ? ((value / total) * 100).toFixed(1) : 0;
              return `${label}: ₹${value.toLocaleString()} (${pct}%)`;
            }
          }
        }
      }
    }
  });

    function updateSummaryCards() {
      // Calculate total savings
      const totalSavings = appState.goals.reduce((sum, goal) => sum + goal.currentSavings, 0);
      document.getElementById('totalSavings').textContent = `₹${formatNumber(totalSavings)}`;
      document.getElementById('totalGoals').textContent = `${appState.goals.length} goal${
        appState.goals.length !== 1 ? 's' : ''
      }`;

      // Calculate household income
      const householdIncome = appState.household.members.reduce(
        (sum, member) => sum + member.income,
        0
      );
      document.getElementById('householdIncome').textContent = `₹${formatNumber(
        householdIncome
      )}`;
      document.getElementById(
        'householdMemberCount'
      ).textContent = `${appState.household.members.length} member${
        appState.household.members.length !== 1 ? 's' : ''
      }`;
        // Calculate net income (NEW CODE)
  const totalExpenses = appState.expenses.reduce((sum, exp) => sum + exp.amount, 0);
  const netIncome = householdIncome - totalExpenses;
  document.getElementById('netIncome').textContent = `₹${formatNumber(netIncome)}`;

        // Leftover income after expenses
        document.getElementById('leftoverIncome').textContent = 
        netIncome > 0 
            ? `Leftover available for savings: ₹${formatNumber(netIncome)}`
            : 'Warning: Expenses exceed income!';

      // Calculate daily income (assuming 30 days in a month)
      const dailyIncome = householdIncome > 0 ? (householdIncome / 30).toFixed(2) : 0;
      document.getElementById(
        'dailyIncome'
      ).textContent = `₹${formatNumber(parseFloat(dailyIncome))} / day`;
    }

    function updateNextGoalsDueCard() {
      const container = document.getElementById('nextGoalsContainer');
      container.innerHTML = '';

      if (appState.goals.length === 0) {
        container.innerHTML = '<p class="text-gray-500">No goals yet.</p>';
        return;
      }

      // Sort goals by target date ascending
      const sortedGoals = [...appState.goals].sort(
        (a, b) => new Date(a.targetDate) - new Date(b.targetDate)
      );

      sortedGoals.forEach((goal) => {
        const today = new Date();
        const targetDate = new Date(goal.targetDate);
        const timeDiff = targetDate.getTime() - today.getTime();
        let daysLeft = Math.ceil(timeDiff / (1000 * 3600 * 24));
        if (daysLeft < 0) daysLeft = -1;

        const relativeText = daysLeft < 0 ? 'Past due' : formatRelativeDue(daysLeft);
        const formattedDate = formatDate(goal.targetDate);

        const row = document.createElement('div');
        row.className = 'flex justify-between';
        row.innerHTML = `
          <span class="font-medium">${goal.name}</span>
          <span>${relativeText}</span>
          <span class="text-gray-500">${formattedDate}</span>
        `;
        container.appendChild(row);
      });
    }

    function updateOverallStatus() {
      // Calculate overall totals
      const totalCostAll = appState.goals.reduce((sum, goal) => sum + goal.cost, 0);
      const totalSavedSoFar = appState.goals.reduce((sum, goal) => sum + goal.currentSavings, 0);
      const totalRemainingAll = totalCostAll - totalSavedSoFar;

      document.getElementById('overallTotalCost').textContent = `₹${formatNumber(
        totalCostAll
      )}`;
      document.getElementById('overallSaved').textContent = `₹${formatNumber(totalSavedSoFar)}`;
      document.getElementById('overallRemaining').textContent = `₹${formatNumber(
        totalRemainingAll
      )}`;
    }

    function updateOverallExpenses() {
      const totalExpAmt = appState.expenses.reduce((sum, exp) => sum + exp.amount, 0);
      // Count unique categories used
      const uniqueCats = [...new Set(appState.expenses.map((exp) => exp.category))].length;

      document.getElementById('overallExpenseAmount').textContent = `₹${formatNumber(
        totalExpAmt
      )}`;
      document.getElementById('expenseCategoriesCount').textContent = `${
        uniqueCats
      } categories`;
      document.getElementById('overallExpenseCats').textContent = `${uniqueCats}`;
      document.getElementById('totalExpenses').textContent = `₹${formatNumber(totalExpAmt)}`;
    }

function updateGoalCards() {
  const goalCards = document.getElementById('goalCards');
  goalCards.innerHTML = '';

  if (appState.goals.length === 0) {
    goalCards.innerHTML = `
      <div class="col-span-full text-center py-8 text-gray-500">
        No savings goals yet. Add your first goal to get started!
      </div>
    `;
    return;
  }

  appState.goals.forEach((goal) => {
    // ----- Achievability Logic Start -----
    const householdIncome = appState.household.members.reduce((sum, m) => sum + m.income, 0);
    const totalExpenses = appState.expenses.reduce((sum, exp) => sum + exp.amount, 0);
    const netIncome = householdIncome - totalExpenses;

    const today = new Date();
    const targetDate = new Date(goal.targetDate);
    const timeDiff = targetDate.getTime() - today.getTime();
    let daysLeft = Math.ceil(timeDiff / (1000 * 3600 * 24));
    if (daysLeft < 1) daysLeft = 1;

    const monthsLeft = Math.max(1, Math.ceil(daysLeft / 30));
    const remainingAmount = goal.cost - goal.currentSavings;
    const monthlyRequiredForGoal = remainingAmount / monthsLeft;

    let canAchieveText = '';
    if (monthlyRequiredForGoal > netIncome) {
      canAchieveText = `<span class="text-xs text-red-600 font-semibold">Not enough leftover income! Need to save more per month to reach this goal on time.</span>`;
    } else {
      canAchieveText = `<span class="text-xs text-green-600 font-semibold">You can achieve this goal by the target date at your current income & expense level.</span>`;
    }
    // ----- Achievability Logic End -----

    // ---- Existing card calculations ----
    const progressPercentage = Math.min(100, ((goal.currentSavings / goal.cost) * 100).toFixed(1));
    const remainingGoal = goal.cost - goal.currentSavings;

    // Required daily/weekly/monthly savings
    const dailyRequired = (remainingGoal / daysLeft).toFixed(2);
    const weeklyRequired = (dailyRequired * 7).toFixed(2);
    const monthlyRequired = (dailyRequired * 30).toFixed(2);

    // Split among contributors
    const contribCount = goal.contributors.length;
    const dailySplit = contribCount > 0 ? (dailyRequired / contribCount).toFixed(2) : dailyRequired;
    const weeklySplit = contribCount > 0 ? (weeklyRequired / contribCount).toFixed(2) : weeklyRequired;
    const monthlySplit = contribCount > 0 ? (monthlyRequired / contribCount).toFixed(2) : monthlyRequired;

    const categoryName = getCategoryName(goal.category);
    const { imgUrl, colorClass } = getCategoryDetails(goal.category);

    // Contributor avatars
    const contributorElements = goal.contributors
      .map((contributorId) => {
        const member = appState.household.members.find((m) => m.id === contributorId);
        if (member) {
          return `<div class="contributor-avatar" title="${member.name}">${member.name.charAt(0)}</div>`;
        }
        return '';
      })
      .join('');

    // ---- Card HTML ----
    const card = document.createElement('div');
    card.className =
      `goal-card ${colorClass} bg-white rounded-xl shadow-md p-6 cursor-pointer relative`;
    card.innerHTML = `
      <div class="flex justify-between items-start mb-4">
        <div class="flex items-center">
          <img src="${imgUrl}" alt="${goal.category}" class="category-img mr-3" />
          <div>
            <h3 class="text-lg font-semibold text-gray-800">${goal.name}</h3>
            <p class="text-xs text-gray-500">${categoryName}</p>
            <p class="text-sm text-gray-500">Bank: ${goal.bankName}</p>
            <p class="text-sm text-gray-500">Target: ${formatDate(goal.targetDate)}</p>
          </div>
        </div>
        <div class="text-right">
          <p class="text-lg font-bold text-gray-800">₹${formatNumber(goal.currentSavings)}</p>
          <p class="text-sm text-gray-500">of ₹${formatNumber(goal.cost)}</p>
        </div>
      </div>
      <div class="mb-4">
        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-1">
          <div
            class="progress-bar bg-indigo-600 h-2.5 rounded-full"
            style="width: ${progressPercentage}%"
          ></div>
        </div>
        <div class="flex justify-between text-xs text-gray-500">
          <span>${progressPercentage}%</span>
          <span>₹${formatNumber(remainingGoal)} left</span>
        </div>
      </div>
      <div class="mb-4 flex items-center space-x-2">
        ${contributorElements}
      </div>
      <div class="mt-4 text-sm text-gray-600 space-y-1">
        <p>
          <strong>Required:</strong> ₹${formatNumber(parseFloat(dailyRequired))} / day,
          ₹${formatNumber(parseFloat(weeklyRequired))} / week,
          ₹${formatNumber(parseFloat(monthlyRequired))} / month
        </p>
        <p>
          <strong>Split Each:</strong> ₹${formatNumber(parseFloat(dailySplit))} / day,
          ₹${formatNumber(parseFloat(weeklySplit))} / week,
          ₹${formatNumber(parseFloat(monthlySplit))} / month
        </p>
      </div>
      <div class="absolute top-4 right-4 text-xs text-gray-700">
        <span id="countdown-${goal.id}" class="font-mono"></span>
      </div>
      <div class="mt-2">${canAchieveText}</div>
    `;

    // Click on card to open details modal
    card.addEventListener('click', () => openGoalDetails(goal.id));

    goalCards.appendChild(card);
  });

  // Immediately update countdowns
  updateAllCountdowns();
}

    function updateAllCountdowns() {
      appState.goals.forEach((goal) => {
        const countdownEl = document.getElementById(`countdown-${goal.id}`);
        if (!countdownEl) return;
        const now = new Date().getTime();
        const target = new Date(goal.targetDate).getTime();
        const diff = target - now;

        if (diff <= 0) {
          countdownEl.textContent = 'Past due';
          return;
        }

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        countdownEl.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
      });
    }

    function updateActivityHistory() {
      const historyTbody = document.getElementById('activityHistorySavings');
      historyTbody.innerHTML = '';

      if (appState.savings.length === 0) {
        historyTbody.innerHTML = `
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="4">
              No savings activity recorded yet
            </td>
          </tr>
        `;
        return;
      }

      // Sort by date descending
      const sortedSavings = [...appState.savings].sort(
        (a, b) => new Date(b.date) - new Date(a.date)
      );

        sortedSavings.forEach((entry) => {
        const member = appState.household.members.find((m) => m.id === entry.memberId);
        const goal = appState.goals.find((g) => g.id === entry.goalId);
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td class="px-6 py-4 ...">${formatDate(entry.date)}</td>
            <td class="px-6 py-4 ...">${member ? member.name : 'Unknown'}</td>
            <td class="px-6 py-4 ...">${goal ? goal.name : 'Unknown'}</td>
            <td class="px-6 py-4 ...">₹${formatNumber(entry.amount)}</td>
            <td class="px-6 py-4 ...">
            <button class="text-red-500 hover:text-red-700 delete-saving-btn" data-id="${entry.id}">Delete</button>
            </td>
        `;
        historyTbody.appendChild(tr);
        tr.querySelector('.delete-saving-btn').addEventListener('click', function () {
            deleteSavingsEntry(entry.id);
        });
        });
    }
function deleteExpenseEntry(id) {
  appState.expenses = appState.expenses.filter(e => e.id !== id);
  saveAppState();
  updateDashboard();
  showNotification("Expense entry deleted.");
}
    function updateExpenseHistory() {
      const historyTbody = document.getElementById('activityHistoryExpenses');
      historyTbody.innerHTML = '';

      if (appState.expenses.length === 0) {
        historyTbody.innerHTML = `
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="4">
              No expenses recorded yet
            </td>
          </tr>
        `;
        return;
      }

      // Sort by date descending
      const sortedExpenses = [...appState.expenses].sort(
        (a, b) => new Date(b.date) - new Date(a.date)
      );

sortedExpenses.forEach((entry) => {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(entry.date)}</td>
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${entry.category}</td>
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${entry.subcategory}</td>
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹${formatNumber(entry.amount)}</td>
    <td class="px-6 py-4 whitespace-nowrap text-sm">
      <button class="text-red-500 hover:text-red-700 delete-expense-btn" data-id="${entry.id}">Delete</button>
    </td>
  `;
  historyTbody.appendChild(tr);

  // Add delete handler
  tr.querySelector('.delete-expense-btn').addEventListener('click', function () {
    deleteExpenseEntry(entry.id);
  });
});
    }

    function updateHouseholdMembersList() {
      const membersList = document.getElementById('householdMembersList');
      membersList.innerHTML = '';

      if (appState.household.members.length === 0) {
        membersList.innerHTML = `
          <div class="col-span-full text-center py-8 text-gray-500">
            No members added yet.
          </div>
        `;
        return;
      }

      appState.household.members.forEach((member) => {
        const memberCard = document.createElement('div');
        memberCard.className =
          'bg-white rounded-xl shadow-md p-4 flex items-center justify-between';
        memberCard.innerHTML = `
          <div class="flex items-center space-x-4">
            <div class="contributor-avatar bg-green-500">${member.name.charAt(0)}</div>
            <div>
              <p class="text-gray-800 font-medium">${member.name}</p>
              <p class="text-gray-500 text-sm">₹${formatNumber(
                member.income
              )} / month</p>
            </div>
          </div>
        `;
        membersList.appendChild(memberCard);
      });
    }

    function updateMembersList() {
      const membersList = document.getElementById('membersList');
      membersList.innerHTML = '';

      if (appState.household.members.length === 0) {
        membersList.innerHTML = `<p class="text-gray-500">No members found.</p>`;
        return;
      }

      appState.household.members.forEach((member) => {
        const memberRow = document.createElement('div');
        memberRow.className = `flex justify-between items-center`;
        memberRow.innerHTML = `
          <div>
            <p class="text-gray-800 font-medium">${member.name}</p>
            <p class="text-gray-500 text-sm">₹${formatNumber(
              member.income
            )} / month</p>
          </div>
          <button class="text-red-500 hover:text-red-700" data-member-id="${
            member.id
          }">Remove</button>
        `;
        membersList.appendChild(memberRow);

        memberRow.querySelector('button').addEventListener('click', () => {
          removeMember(member.id);
        });
      });
    }

    function addHouseholdMemberField() {
      const container = document.getElementById('householdMembers');
      const index = container.querySelectorAll('.household-member').length + 1;

      const memberDiv = document.createElement('div');
      memberDiv.className = 'flex items-center space-x-4 household-member';

      memberDiv.innerHTML = `
        <div class="w-2/3">
          <label class="block text-sm font-medium text-gray-700 mb-1">Member Name</label>
          <input
            type="text"
            class="member-name input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
            placeholder="Enter member name"
          />
        </div>
        <div class="w-1/3">
          <label class="block text-sm font-medium text-gray-700 mb-1">Income</label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">₹</span>
            <input
              type="number"
              class="member-income input-field w-full pl-8 px-4 py-2 border rounded-lg focus:outline-none"
              placeholder="Income"
            />
          </div>
        </div>
      `;
      container.appendChild(memberDiv);
    }

    function updateGoalContributors() {
      // For each goal-item, populate contributors checkboxes
      const goalOptionsWrapper = document.querySelectorAll('.goal-contributors');
      goalOptionsWrapper.forEach((wrapper) => {
        wrapper.innerHTML = '';
        appState.household.members.forEach((member) => {
          const checkboxId = `contrib-${member.id}-${Math.random()
            .toString(36)
            .substring(2, 7)}`;
          const checkboxWrapper = document.createElement('div');
          checkboxWrapper.className = 'flex items-center space-x-2';
          checkboxWrapper.innerHTML = `
            <input
              type="checkbox"
              value="${member.id}"
              id="${checkboxId}"
              class="goal-contributor-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded"
            />
            <label for="${checkboxId}" class="text-sm text-gray-700">${member.name}</label>
          `;
          wrapper.appendChild(checkboxWrapper);
        });
      });
    }

    function addGoalField() {
      const goalsList = document.getElementById('goalsList');
      const goalCount = goalsList.querySelectorAll('.goal-item').length + 1;

      const goalDiv = document.createElement('div');
      goalDiv.className = 'goal-item border border-gray-200 rounded-lg p-4 relative';

      goalDiv.innerHTML = `
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-medium text-gray-800">Goal #${goalCount}</h3>
          <button type="button" class="remove-goal">
            <img
              src="https://cdn-icons-png.flaticon.com/512/1828/1828774.png"
              alt="Remove Goal"
              class="w-5 h-5"
            />
          </button>
        </div>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Item Category</label>
            <select
              class="goal-category input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
              required
            >
              <option value="">Select a category</option>
              <option value="home">Home/Property</option>
              <option value="car">Vehicle</option>
              <option value="electronics">Electronics</option>
              <option value="furniture">Furniture</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
            <input
              type="text"
              class="goal-name input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
              placeholder="e.g., New Home, Car, TV, etc."
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Total Cost</label>
            <div class="relative">
              <span
                class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500"
                >₹</span
              >
              <input
                type="number"
                class="goal-cost input-field w-full pl-8 px-4 py-2 border rounded-lg focus:outline-none"
                placeholder="Enter the total cost"
                required
              />
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Target Date</label>
            <input
              type="date"
              class="goal-date input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Bank Name</label>
            <input
              type="text"
              class="goal-bank input-field w-full px-4 py-2 border rounded-lg focus:outline-none"
              placeholder="Bank where saving"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Contributors</label>
            <div class="goal-contributors flex flex-wrap gap-2"></div>
          </div>
        </div>
      `;

      goalsList.appendChild(goalDiv);

      // Add functionality to remove this goal field
      const removeBtn = goalDiv.querySelector('.remove-goal');
      removeBtn.addEventListener('click', () => {
        goalDiv.remove();
        // Re-label remaining goals
        const remainingGoals = document.querySelectorAll('.goal-item');
        remainingGoals.forEach((item, idx) => {
          item.querySelector('h3').textContent = `Goal #${idx + 1}`;
        });
      });

      updateGoalContributors();
    }

    function openSavingsModal() {
      // Populate contributors dropdown
      const memberSelect = document.getElementById('savingsMember');
      memberSelect.innerHTML = '<option value="">Select Contributor</option>';
      appState.household.members.forEach((member) => {
        const option = document.createElement('option');
        option.value = member.id;
        option.textContent = member.name;
        memberSelect.appendChild(option);
      });

      // Populate goals dropdown
      const goalSelect = document.getElementById('savingsGoal');
      goalSelect.innerHTML = '<option value="">Select Goal</option>';
      appState.goals.forEach((goal) => {
        const option = document.createElement('option');
        option.value = goal.id;
        option.textContent = goal.name;
        goalSelect.appendChild(option);
      });

      document.getElementById('savingsModal').classList.remove('hidden');
    }

    function closeSavingsModal() {
      document.getElementById('savingsModal').classList.add('hidden');
    }

    function openExpenseModal() {
      // Reset form
      document.getElementById('addExpenseForm').reset();
      document.getElementById('expenseSubcategory').innerHTML = '<option value="">Select Subcategory</option>';
      document.getElementById('customExpenseCategoryContainer').classList.add('hidden');
      document.getElementById('customExpenseSubcategoryContainer').classList.add('hidden');
      document.getElementById('subCategoryContainer').classList.remove('hidden');

      document.getElementById('expenseModal').classList.remove('hidden');
    }

    function closeExpenseModal() {
      document.getElementById('expenseModal').classList.add('hidden');
    }

    function openGoalModal() {
      // Populate contributors checkboxes in modal
      const container = document.getElementById('modalGoalContributors');
      container.innerHTML = '';
      appState.household.members.forEach((member) => {
        const checkboxId = `modal-contrib-${member.id}-${Math.random()
          .toString(36)
          .substring(2, 7)}`;
        const wrapper = document.createElement('div');
        wrapper.className = 'flex items-center space-x-2';
        wrapper.innerHTML = `
          <input
            type="checkbox"
            value="${member.id}"
            id="${checkboxId}"
            class="h-4 w-4 text-indigo-600 border-gray-300 rounded"
          />
          <label for="${checkboxId}" class="text-gray-700">${member.name}</label>
        `;
        container.appendChild(wrapper);
      });

      document.getElementById('goalModal').classList.remove('hidden');
    }

    function closeGoalModal() {
      document.getElementById('goalModal').classList.add('hidden');
    }

    function openMembersModal() {
      updateMembersList();
      document.getElementById('membersModal').classList.remove('hidden');
    }

    function closeMembersModal() {
      document.getElementById('membersModal').classList.add('hidden');
    }

    function openGoalDetails(goalId) {
      const goal = appState.goals.find((g) => g.id === goalId);
      if (!goal) return;

      // Set modal goal id
      const modal = document.getElementById('goalDetailsModal');
      modal.setAttribute('data-goal-id', goalId);

      // Populate goal details
      document.getElementById('detailsGoalName').textContent = goal.name;
      document.getElementById('detailsGoalCategory').textContent = getCategoryName(
        goal.category
      );
      document.getElementById('detailsGoalCost').textContent = `₹${formatNumber(
        goal.cost
      )}`;
      document.getElementById('detailsGoalSavings').textContent = `₹${formatNumber(
        goal.currentSavings
      )}`;
      document.getElementById('detailsGoalDate').textContent = formatDate(goal.targetDate);
      document.getElementById('detailsGoalBank').textContent = goal.bankName;

      const percentage = Math.min(100, ((goal.currentSavings / goal.cost) * 100).toFixed(1));
      document.getElementById('detailsGoalPercentage').textContent = `${percentage}%`;
      const remaining = Math.max(0, goal.cost - goal.currentSavings);
      document.getElementById('detailsGoalRemaining').textContent = `₹${formatNumber(
        remaining
      )}`;
      document.getElementById('detailsGoalProgress').style.width = `${percentage}%`;

      // Contributors
      const contribContainer = document.getElementById('detailsGoalContributors');
      contribContainer.innerHTML = '';
      goal.contributors.forEach((contributorId) => {
        const member = appState.household.members.find((m) => m.id === contributorId);
        if (member) {
          const avatar = document.createElement('div');
          avatar.className = 'contributor-avatar';
          avatar.title = member.name;
          avatar.textContent = member.name.charAt(0);
          contribContainer.appendChild(avatar);
        }
      });

      // Savings history for that goal
      const historyBody = document.getElementById('detailsGoalHistory');
      historyBody.innerHTML = '';
      const goalSavings = appState.savings
        .filter((entry) => entry.goalId === goalId)
        .sort((a, b) => new Date(b.date) - new Date(a.date));

      if (goalSavings.length === 0) {
        historyBody.innerHTML = `
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" colspan="4">
              No savings recorded yet
            </td>
          </tr>
        `;
      } else {
        goalSavings.forEach((entry) => {
          const member = appState.household.members.find((m) => m.id === entry.memberId);
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(
              entry.date
            )}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
              member ? member.name : 'Unknown'
            }</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₹${formatNumber(
              entry.amount
            )}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${
              entry.notes || '-'
            }</td>
          `;
          historyBody.appendChild(tr);
        });
      }

      modal.classList.remove('hidden');
    }

    function closeGoalDetailsModal() {
      const modal = document.getElementById('goalDetailsModal');
      modal.removeAttribute('data-goal-id');
      modal.classList.add('hidden');
    }

function renderIncomeExpensesPie(income, expenses) {
  const leftover = Math.max(income - expenses, 0);
  const ctx = document.getElementById('incomeExpensesPie').getContext('2d');
  if (window.incomeExpensesPieChart) {
    window.incomeExpensesPieChart.destroy();
  }
  window.incomeExpensesPieChart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Income', 'Expenses', 'Leftover'],
      datasets: [{
        data: [income, expenses, leftover],
        backgroundColor: ['#22c55e', '#f59e42', '#3b82f6'],
      }]
    },
    options: {
      plugins: {
        legend: { display: false }
      }
    }
  });

  // Custom legend
  const colors = ['#22c55e', '#f59e42', '#3b82f6'];
  const labels = ['Income', 'Expenses', 'Leftover'];
  const legendHtml = labels.map((label, i) =>
    `<span class="legend-item"><span class="legend-color" style="background:${colors[i]}"></span>${label}</span>`
  ).join('');
  document.getElementById('pieLegend').innerHTML = `<div class="chart-legend">${legendHtml}</div>`;
}

let monthlyExpensesChart = null;
let expenseCategoryChart = null;

function updateCharts() {
  renderMonthlyExpensesChart();
  renderExpenseCategoryChart();
}

function renderMonthlyExpensesChart() {
  // Prepare data: group expenses by month
  const monthlyTotals = {};
  appState.expenses.forEach(exp => {
    const month = new Date(exp.date);
    const label = month.toLocaleString('default', { month: 'short', year: '2-digit' }); // e.g., "Jun '25"
    monthlyTotals[label] = (monthlyTotals[label] || 0) + exp.amount;
  });

  // Sort by date
  const labels = Object.keys(monthlyTotals).sort((a, b) => {
    const [am, ay] = a.split(" ");
    const [bm, by] = b.split(" ");
    return new Date(`${am} 1 20${ay}`) - new Date(`${bm} 1 20${by}`);
  });
  const data = labels.map(label => monthlyTotals[label]);

  // Destroy previous chart if exists
  if (monthlyExpensesChart) monthlyExpensesChart.destroy();

  const ctx = document.getElementById('monthlyExpensesChart').getContext('2d');
  monthlyExpensesChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'Total Expenses',
        data,
        backgroundColor: '#f59e42',
        borderRadius: 10,
        maxBarThickness: 30,
      }]
    },
    options: {
      responsive: false,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { callback: value => `₹${value.toLocaleString()}` }
        }
      }
    }
  });
}

function renderExpenseCategoryChart() {
  // Prepare data: group expenses by category
  const catTotals = {};
  appState.expenses.forEach(exp => {
    catTotals[exp.category] = (catTotals[exp.category] || 0) + exp.amount;
  });

  const labels = Object.keys(catTotals);
  const data = labels.map(label => catTotals[label]);

  // Destroy previous chart if exists
  if (expenseCategoryChart) expenseCategoryChart.destroy();

  const ctx = document.getElementById('expenseCategoryChart').getContext('2d');
  expenseCategoryChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: [
          '#3b82f6', '#16a34a', '#f59e42', '#6366f1', '#f43f5e', '#fde68a', '#a21caf'
        ]
      }]
    },
    options: {
      responsive: false,
      plugins: {
        legend: {
          display: true,
          position: 'bottom'
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.label || '';
              const value = context.parsed;
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const pct = total ? ((value / total) * 100).toFixed(1) : 0;
              return `${label}: ₹${value.toLocaleString()} (${pct}%)`;
            }
          }
        }
      }
    }
  });
}

// DEBUG: Hide dashboard if not logged in!
if (!appState.auth.isLoggedIn) {
  document.getElementById('dashboard').classList.add('hidden');
}

</script>
  
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>
